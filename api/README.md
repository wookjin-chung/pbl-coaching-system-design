# API Design & OpenAPI Contract

이 디렉토리는 **PBL 코칭 시스템의 API 설계 기준과 OpenAPI 계약의 단일 소스(Source of Truth)** 를 담고 있습니다.

이곳의 문서와 스펙은:
- 구현 코드가 아니라 **행동 계약(Behavioral Contract)** 이며
- 프론트엔드·백엔드·AI 계층이 **공통으로 따라야 할 기준**입니다.

---

## 이 디렉토리의 역할

`api/` 디렉토리는 다음을 책임집니다.

- API가 **무엇을 의미하는지** (철학/경계)
- API가 **어떤 약속을 지켜야 하는지** (행동 계약)
- API 계약의 **최종 스키마 원본** (OpenAPI YAML)

반대로, 다음은 **의도적으로 포함하지 않습니다.**

- 런타임 API 클라이언트 코드
- fetch / axios / React hooks
- 서버 구현 코드
- 에러 처리 로직의 실제 구현

👉 구현은 **별도의 서비스 코드 레포**에서 이루어집니다.

---

## 파일 구성

### `openapi_contract.md`
- API 설계의 **상위 헌법 문서**
- 판단 비대체 원칙
- 신호(signal) 중심 설계
- Path Awareness / AI 역할 경계 반영 기준

👉 OpenAPI YAML은 이 문서를 **구현**해야 합니다.

---

### `openapi.yaml`
- PBL 코칭 서비스의 **최종 API 계약 원본**
- 프론트/백엔드 타입 생성의 기준
- 계약 변경 시 가장 먼저 수정되는 파일

이 파일은:
- 기능 명세서가 아니라
- **행동과 흐름의 계약**입니다.

---

### (선택) `generated/`
- `openapi.yaml`로부터 생성된 타입의 **참고용 산출물**
- 학습/검토 목적
- **실제 서비스 코드에서 직접 import 하지 않습니다.**

---

## OpenAPI 계약의 성격

이 시스템에서 OpenAPI는 단순한 인터페이스 정의가 아닙니다.

> **OpenAPI = 사용자의 기록·자각·정리 흐름을  
> 끊지 않겠다는 서비스의 약속**

따라서 OpenAPI 설계는 다음을 포함합니다.

- 판단을 대신하지 않는 응답 구조
- 결론을 닫지 않는 AI 응답 메타
- 시간 축(과거/현재/미래) 단일 활성 원칙
- 점수·등급·평가 필드의 의도적 부재

---

## 버전 관리 원칙

### 계약 우선 순서

API 변경은 반드시 다음 순서를 따릅니다.

1. `openapi_contract.md` (설계 원칙 변경 여부 검토)
2. `openapi.yaml` (계약 스키마 수정)
3. 타입 생성 (구현 레포)
4. 실제 구현 반영

---

### 버전 정책(권장)

- `openapi.yaml`은 **명시적 버전 필드**를 가집니다.
- 초기 MVP 단계에서는:
  - `0.x.y` 또는
  - 날짜 기반 버전 (`2024-xx-xx`)

을 권장합니다.

---

## 타입 자동 생성 (구현 레포 기준)

이 레포에서는 타입을 **생성하지 않습니다.**  
다만, 구현 레포에서의 표준 방식을 아래에 명시합니다.

### 권장 도구
- `openapi-typescript`

### 예시 커맨드
```bash
npx openapi-typescript ./api/openapi.yaml \
  --output packages/shared-types/src/api.d.ts
